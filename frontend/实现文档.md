# 股票交易系统 - 前端实现文档

## 1. 项目结构

### 1.1 目录结构
```
frontend/
├── src/
│   ├── pages/           # 页面组件
│   │   ├── Login.jsx    # 登录页
│   │   ├── Toolbox.jsx  # 工具箱首页
│   │   ├── StockSelector.jsx  # 选股工具（开发中）
│   │   └── Backtest.jsx # 回测工具（开发中）
│   ├── services/        # 服务层
│   │   └── api.js       # API 配置
│   ├── App.jsx          # 根组件
│   ├── main.jsx         # 入口文件
│   └── index.css        # 全局样式
├── index.html           # HTML 模板
├── package.json         # 依赖配置
└── vite.config.js       # Vite 配置
```

### 1.2 技术栈
- **前端框架**：React 18.3.1
- **构建工具**：Vite 5.4.8
- **UI 组件库**：Ant Design 5.21.0
- **路由管理**：React Router 6.26.0
- **HTTP 客户端**：Axios 1.7.7
- **图表库**：Recharts 2.13.3

## 2. 核心模块实现

### 2.1 应用入口 ([main.jsx](file:///Users/noctis/Documents/code/stock/StockTradebyZ/frontend/src/main.jsx))

```javascript
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.jsx'
import './index.css'

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)
```

**实现说明**：
- 使用 React 18 的 createRoot API
- 启用 StrictMode 进行开发时检查
- 挂载到 index.html 中的 root 元素

### 2.2 路由配置 ([App.jsx](file:///Users/noctis/Documents/code/stock/StockTradebyZ/frontend/src/App.jsx))

```javascript
import React from 'react';
import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';
import Login from './pages/Login';
import Toolbox from './pages/Toolbox';
import StockSelector from './pages/StockSelector';
import Backtest from './pages/Backtest';

const PrivateRoute = ({ children }) => {
  const token = localStorage.getItem('token');
  return token ? children : <Navigate to="/login" />;
};

const App = () => {
  return (
    <Router>
      <Routes>
        <Route path="/login" element={<Login />} />
        <Route
          path="/toolbox"
          element={
            <PrivateRoute>
              <Toolbox />
            </PrivateRoute>
          }
        />
        <Route
          path="/stock-selector"
          element={
            <PrivateRoute>
              <StockSelector />
            </PrivateRoute>
          }
        />
        <Route
          path="/backtest"
          element={
            <PrivateRoute>
              <Backtest />
            </PrivateRoute>
          }
        />
        <Route path="/" element={<Navigate to="/login" />} />
      </Routes>
    </Router>
  );
};

export default App;
```

**实现说明**：
- 使用 React Router 6 进行路由管理
- PrivateRoute 组件实现路由守卫
- 未登录用户自动重定向到登录页
- 根路径重定向到登录页

### 2.3 API 服务层 ([api.js](file:///Users/noctis/Documents/code/stock/StockTradebyZ/frontend/src/services/api.js))

```javascript
import axios from 'axios';

const api = axios.create({
  baseURL: '/api',
  timeout: 10000,
});

api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      localStorage.removeItem('token');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export const authAPI = {
  login: (username, password) => {
    return api.post('/auth/login/json', { username, password });
  },
};

export default api;
```

**实现说明**：
- 创建 axios 实例，配置 baseURL 和超时时间
- 请求拦截器：自动添加 Authorization 头
- 响应拦截器：处理 401 未授权错误
- 提供 authAPI 模块封装认证相关接口

### 2.4 登录页面 ([Login.jsx](file:///Users/noctis/Documents/code/stock/StockTradebyZ/frontend/src/pages/Login.jsx))

**核心功能**：
1. 表单验证
2. 登录请求
3. Token 存储
4. 登录成功跳转

**实现要点**：
- 使用 Ant Design Form 组件
- 使用 useState 管理加载状态
- 使用 useNavigate 进行路由跳转
- 登录成功后将 Token 存储到 localStorage
- 渐变色背景设计

**关键代码**：
```javascript
const onFinish = async (values) => {
  setLoading(true);
  try {
    const response = await authAPI.login(values.username, values.password);
    localStorage.setItem('token', response.data.access_token);
    message.success('登录成功');
    navigate('/toolbox');
  } catch (error) {
    message.error(error.response?.data?.detail || '登录失败，请检查用户名和密码');
  } finally {
    setLoading(false);
  }
};
```

### 2.5 工具箱页面 ([Toolbox.jsx](file:///Users/noctis/Documents/code/stock/StockTradebyZ/frontend/src/pages/Toolbox.jsx))

**核心功能**：
1. 工具卡片展示
2. 工具导航
3. 用户登出

**实现要点**：
- 使用 Ant Design Layout 组件
- 使用 Card 组件展示工具卡片
- 使用 Space 组件进行布局
- 响应式设计

**工具配置**：
```javascript
const tools = [
  {
    id: 'stock-selector',
    title: '选股工具',
    description: '智能选股分析',
    icon: <StockOutlined style={{ fontSize: '48px', color: '#1890ff' }} />,
    onClick: () => navigate('/stock-selector')
  },
  {
    id: 'backtest',
    title: '回测工具',
    description: '策略回测分析',
    icon: <LineChartOutlined style={{ fontSize: '48px', color: '#52c41a' }} />,
    onClick: () => navigate('/backtest')
  }
];
```

### 2.6 选股工具页面 ([StockSelector.jsx](file:///Users/noctis/Documents/code/stock/StockTradebyZ/frontend/src/pages/StockSelector.jsx))

**当前状态**：占位页面，功能开发中

**实现说明**：
- 使用 Ant Design Result 组件
- 提供返回工具箱的按钮
- 预留功能开发空间

### 2.7 回测工具页面 ([Backtest.jsx](file:///Users/noctis/Documents/code/stock/StockTradebyZ/frontend/src/pages/Backtest.jsx))

**当前状态**：占位页面，功能开发中

**实现说明**：
- 使用 Ant Design Result 组件
- 提供返回工具箱的按钮
- 预留功能开发空间

### 2.8 全局样式 ([index.css](file:///Users/noctis/Documents/code/stock/StockTradebyZ/frontend/src/index.css))

**样式规范**：
- 重置默认样式
- 设置字体栈
- 代码字体配置
- 根元素最小高度

## 3. 数据流设计

### 3.1 认证流程
```
用户输入凭证
    ↓
前端验证
    ↓
发送登录请求
    ↓
后端验证
    ↓
返回 Token
    ↓
存储 Token
    ↓
跳转到工具箱
```

### 3.2 路由守卫流程
```
访问受保护路由
    ↓
检查 Token 是否存在
    ↓
Token 存在 → 允许访问
    ↓
Token 不存在 → 重定向到登录页
```

### 3.3 API 请求流程
```
发起请求
    ↓
请求拦截器添加 Token
    ↓
发送到后端
    ↓
响应拦截器处理
    ↓
返回数据或处理错误
```

## 4. 状态管理

### 4.1 当前状态管理方式
- 使用 React Hooks（useState、useEffect）
- 使用 localStorage 持久化 Token
- 使用 React Router 管理路由状态

### 4.2 未来状态管理建议
- 考虑使用 Context API 或 Redux
- 实现全局状态管理
- 优化组件间数据传递

## 5. 组件设计

### 5.1 组件层次结构
```
App
├── Login
├── Toolbox
│   ├── Header
│   └── Content
│       ├── ToolCard (选股工具)
│       └── ToolCard (回测工具)
├── StockSelector
└── Backtest
```

### 5.2 组件复用性
- PrivateRoute：可复用的路由守卫组件
- ToolCard：可扩展的工具卡片组件
- API 服务：统一的请求封装

## 6. 安全实现

### 6.1 认证安全
- Token 存储在 localStorage
- 请求时自动添加 Authorization 头
- 401 错误自动清除 Token 并跳转登录

### 6.2 路由安全
- 所有业务路由都需要认证
- 未登录用户无法访问受保护页面

### 6.3 数据安全
- HTTPS 传输（生产环境）
- 敏感信息不暴露在前端代码

## 7. 性能优化

### 7.1 已实现的优化
- 使用 Vite 进行快速构建
- 代码分割（React Router）
- 组件懒加载（可进一步优化）

### 7.2 可优化的方向
- 图片懒加载
- 虚拟滚动（长列表）
- 缓存策略
- CDN 加速

## 8. 构建与部署

### 8.1 开发环境
```bash
npm install
npm run dev
```

### 8.2 生产构建
```bash
npm run build
```

### 8.3 预览构建
```bash
npm run preview
```

### 8.4 代码检查
```bash
npm run lint
```

## 9. 配置文件

### 9.1 package.json
```json
{
  "name": "stock-trade-frontend",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-router-dom": "^6.26.0",
    "antd": "^5.21.0",
    "recharts": "^2.13.3",
    "axios": "^1.7.7"
  }
}
```

### 9.2 vite.config.js
```javascript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
})
```

## 10. 开发规范

### 10.1 代码风格
- 使用 ESLint 进行代码检查
- 遵循 React 最佳实践
- 使用函数式组件和 Hooks

### 10.2 命名规范
- 组件名使用 PascalCase
- 文件名使用 PascalCase（组件）或 camelCase（工具）
- 变量名使用 camelCase
- 常量名使用 UPPER_SNAKE_CASE

### 10.3 注释规范
- 复杂逻辑添加注释
- 函数添加 JSDoc 注释
- TODO 标记待完成功能

## 11. 测试策略

### 11.1 单元测试
- 组件测试
- 工具函数测试
- API 服务测试

### 11.2 集成测试
- 路由测试
- 表单测试
- API 集成测试

### 11.3 E2E 测试
- 用户流程测试
- 跨浏览器测试

## 12. 问题排查

### 12.1 常见问题

**问题 1：登录后 Token 未保存**
- 检查 localStorage 是否可用
- 检查 API 响应格式

**问题 2：路由跳转失败**
- 检查路由配置
- 检查 Token 是否存在

**问题 3：API 请求失败**
- 检查后端服务是否启动
- 检查 baseURL 配置
- 检查网络连接

### 12.2 调试技巧
- 使用浏览器开发者工具
- 查看网络请求
- 检查 Console 日志
- 使用 React DevTools

## 13. 未来扩展

### 13.1 功能扩展
- 完善选股工具功能
- 完善回测工具功能
- 添加数据可视化
- 添加用户设置

### 13.2 技术扩展
- 添加 TypeScript 支持
- 添加单元测试
- 添加状态管理
- 优化性能

### 13.3 架构扩展
- 微前端架构
- 服务端渲染（SSR）
- PWA 支持

## 14. 参考资源

### 14.1 官方文档
- [React](https://react.dev/)
- [Vite](https://vitejs.dev/)
- [Ant Design](https://ant.design/)
- [React Router](https://reactrouter.com/)

### 14.2 学习资源
- React Hooks 最佳实践
- 前端性能优化指南
- 安全编码规范

## 15. 版本历史

### v0.0.0（当前版本）
- 实现基础框架
- 实现用户认证
- 实现工具箱页面
- 预留功能扩展接口