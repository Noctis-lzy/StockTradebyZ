# 股票交易系统 - 前端需求文档

## 1. 项目概述

### 1.1 项目名称
反者知行 - 股票交易系统（前端）

### 1.2 项目简介
一个基于 Web 的股票交易辅助系统前端，提供智能选股、策略回测等功能，帮助用户进行股票投资决策。

### 1.3 目标用户
- 股票投资者
- 量化交易从业者
- 金融分析师

## 2. 功能需求

### 2.1 用户认证模块

#### 2.1.1 用户登录
- **功能描述**：提供用户登录功能，验证用户身份
- **需求详情**：
  - 支持用户名/密码登录
  - 登录成功后获取访问令牌（Token）
  - Token 存储在浏览器本地存储中
  - 登录失败时显示错误提示
  - 提供默认测试账号（admin/admin123）

#### 2.1.2 用户登出
- **功能描述**：提供用户登出功能，清除用户会话
- **需求详情**：
  - 清除本地存储的 Token
  - 重定向到登录页面

#### 2.1.3 路由守卫
- **功能描述**：保护需要认证的路由
- **需求详情**：
  - 检查用户是否已登录（Token 是否存在）
  - 未登录用户自动重定向到登录页面
  - 已登录用户可访问所有受保护页面

### 2.2 工具箱模块

#### 2.2.1 工具箱首页
- **功能描述**：展示系统提供的所有工具入口
- **需求详情**：
  - 以卡片形式展示各个工具
  - 每个工具卡片包含：图标、标题、描述
  - 点击卡片跳转到对应工具页面
  - 提供退出登录按钮

#### 2.2.2 工具列表
- **选股工具**：智能选股分析功能
- **批量回测工具**：策略回测分析功能
- **个股回测工具**：个股细节买卖点的分析功能

#### 2.3 策略管理
#### 2.3.1 策略
- **功能描述**：策略是指标的集合，用于分析股票走势并生成交易信号
- **需求详情**：
  - 每个用户可用系统策略和自己创建的策略
  - 策略类型：
    - 系统默认策略
    - 用户自定义策略
  - 策略执行：支持手动执行和定时自动执行
  - 策略结果：生成交易信号（买入/卖出/持有）和分析报告

#### 2.3.1.1 系统默认策略
- **功能描述**：系统提供的默认策略，由系统实现，调用时执行具体的py类
- **需求详情**：
  - 系统默认策略：
    - 双线策略：基于两条移动平均线的交叉信号
    - 单针策略：基于K线形态的反转信号
    - 砖型图策略：基于价格突破的趋势信号
  - 默认策略参数：系统提供合理的默认参数，用户可在使用时调整
  - 默认策略说明：每个策略提供详细的使用说明和适用场景

#### 2.3.1.2 用户自定义策略（规划中, 先不实现）
- **功能描述**：用户可自定义策略，调用时按顺序执行所关联的指标
- **需求详情**：
  - 用户可自行增删改查：用户可以创建、删除、修改、查询自定义策略
  - 自定义策略格式：由多个指标与指标参数组成，支持逻辑条件组合
  - 策略保存：自动保存用户创建的策略到个人空间
  - 策略导入导出：支持策略的导入和导出，方便备份和分享
  - 策略版本管理：记录策略的修改历史，支持版本回滚

#### 2.3.2 指标
- **功能描述**：系统提供的技术指标，用于量化分析股票数据
- **需求详情**：
  - 指标定义：构成策略的最小原子单位，所有的指标均由系统提供，用户可在自定义策略中使用，设置数值等
  - 指标计算：系统实时计算指标值，确保数据准确性和时效性
  - 指标展示：支持指标的图表化展示，直观反映指标变化
  - 系统默认指标：
    - 当日收盘价：股票当日交易结束时的价格
    - 散户成本线指标：反映散户平均持仓成本
    - 大哥成本线指标：反映主力资金平均持仓成本
    - KDJ指标：随机指标，用于判断股票超买超卖
    - MA指标：移动平均线，反映价格趋势
    - 成交量MA指标：成交量移动平均线，反映成交量趋势
    - MACD指标：指数平滑异同移动平均线，用于判断价格动能
  - 指标参数：每个指标提供可调整的参数，如周期、阈值等
  - 指标说明：每个指标提供详细的计算公式和使用说明

### 2.4 选股工具模块
做二级页签，包含系统选股、策略选股和选股结果分析
#### 2.4.1 系统选股
- **功能描述**：基于系统默认策略进行股票筛选，支持定时任务和手动执行
- **需求详情**：
  - 进入页面后展示选股任务列表（与 2.8 选股任务管理模块集成）
  - 支持创建新的系统选股任务
  - 每个任务包含：任务名称、创建时间、任务状态（待执行/执行中/已完成/失败）
  - 支持任务操作：不支持任何操作，属于系统定时任务行为
  - 点击任务可查看详细信息（跳转到任务详情页）
  - 支持任务搜索和筛选

#### 2.4.2 策略选股
- **功能描述**：用户选择特定策略并配置筛选条件进行股票筛选
- **需求详情**：
  - 策略选择：单选策略，不可为空，从系统默认策略中选择
  - 支持策略参数调整：用户可根据需要调整策略的参数值
  - 股票条件配置：
    - 价格范围筛选：设置股票价格的最小值和最大值
    - 市场板块筛选：支持主板、创业板、科创板筛选
    - 市值范围筛选：设置股票市值的最小值和最大值
    - 市盈率范围筛选：设置股票市盈率的最小值和最大值
    - 行业筛选：支持按行业类别筛选股票
  - 股票池配置：选择股票来源（全市场、自定义股票列表）
  - 立即执行：配置完成后可立即执行选股
  - 保存为任务：可将配置保存为定时选股任务

#### 2.4.3 选股结果分析
- **功能描述**：展示和分析选股结果，分为三部分，上方放股票代码结果块，左下放股票列表，右下放板块饼状图
- **需求详情**：
  - 股票代码结果块：用逗号隔开选出来的股票代码，单独成块方便复制
  - 结果列表：以表格形式展示符合条件的股票列表
  - 结果字段：股票代码、股票名称、所属行业
  - 结果排序：支持按各种字段排序
  - 结果对比：支持与历史选股结果进行对比

#### 2.4.4 股票分析（规划中）
- **功能描述**：展示股票的详细分析数据
- **需求详情**：
  - 基本信息：股票代码、名称、所属行业、上市日期、总股本、流通股本等
  - 技术指标分析：展示 KDJ、MA、MACD 等技术指标
  - 历史走势图表：展示股票价格、成交量的历史走势
  - 基本面分析：市盈率、市净率、营收、利润等财务数据
  - 资金流向：主力资金、散户资金的流向分析
  - 同行业对比：与同行业其他股票的关键指标对比

### 2.5 批量回测工具模块（规划中）

#### 2.5.1 策略配置
- **功能描述**：配置回测策略参数
- **需求详情**：
  - 支持多种策略类型
  - 可配置买入/卖出条件
  - 可设置回测时间范围

#### 2.5.2 回测执行
- **功能描述**：执行策略回测
- **需求详情**：
  - 基于历史数据执行回测
  - 显示回测进度
  - 支持回测中断

#### 2.5.3 回测结果展示
- **功能描述**：展示回测结果
- **需求详情**：
  - 展示收益率曲线
  - 展示关键指标（夏普比率、最大回撤等）
  - 展示交易明细
  - 支持结果导出

### 2.6 个股回测工具模块（规划中）

#### 2.6.1 个股选择
- **功能描述**：选择要进行回测的个股
- **需求详情**：
  - 支持股票代码搜索
  - 支持股票名称搜索
  - 显示股票基本信息

#### 2.6.2 策略配置
- **功能描述**：配置个股回测策略参数
- **需求详情**：
  - 支持多种技术指标策略
  - 可配置买入/卖出条件
  - 可设置回测时间范围
  - 支持参数优化

#### 2.6.3 回测执行
- **功能描述**：执行个股策略回测
- **需求详情**：
  - 基于历史数据执行回测
  - 显示回测进度
  - 支持回测中断

#### 2.6.4 买卖点分析
- **功能描述**：分析个股的买卖点
- **需求详情**：
  - 在K线图上标记买入/卖出点
  - 显示每个买卖点的详细数据
  - 支持买卖点筛选和过滤
  - 展示买卖点成功率统计

#### 2.6.5 回测结果展示
- **功能描述**：展示个股回测结果
- **需求详情**：
  - 展示收益率曲线
  - 展示关键指标（胜率、盈亏比等）
  - 展示交易明细
  - 支持结果导出

### 2.7 定时任务工作流模块

#### 2.7.1 定时任务配置
- **功能描述**：配置和管理定时任务
- **需求详情**：
  - 支持多种定时策略（Cron 表达式、固定间隔、指定时间点）
  - 支持任务优先级设置
  - 支持任务超时时间配置
  - 支持任务重试机制配置（重试次数、重试间隔）
  - 支持任务依赖关系配置（前置任务、后置任务）
  - 支持任务并发控制（最大并发数）
  - 支持任务执行时间窗口设置

#### 2.7.2 任务调度引擎
- **功能描述**：负责任务的调度和执行
- **需求详情**：
  - 基于 Cron 表达式的精确调度
  - 支持动态添加、删除、修改任务
  - 支持任务暂停和恢复
  - 支持任务立即执行（手动触发）
  - 支持任务执行状态实时监控
  - 支持任务队列管理
  - 支持任务失败自动重试
  - 支持任务执行日志记录

#### 2.7.3 任务执行监控
- **功能描述**：监控任务执行状态和性能
- **需求详情**：
  - 实时显示任务执行状态（待执行、执行中、已完成、失败、已取消）
  - 显示任务执行进度
  - 显示任务执行耗时
  - 显示任务执行日志
  - 支持任务执行历史查询
  - 支持任务执行统计（成功率、平均耗时等）
  - 支持任务异常告警（邮件、短信、站内消息）

#### 2.7.4 任务结果管理
- **功能描述**：管理任务执行结果
- **需求详情**：
  - 存储任务执行结果数据
  - 支持结果数据导出（CSV、Excel、JSON）
  - 支持结果数据可视化展示
  - 支持结果数据对比分析
  - 支持结果数据归档
  - 支持结果数据删除

### 2.8 选股任务管理模块

#### 2.8.1 选股任务实体
- **功能描述**：定义选股任务的数据结构和属性
- **需求详情**：
  - 任务基本信息：
    - 任务 ID（唯一标识）
    - 任务名称
    - 任务描述
    - 任务类型（选股任务）
    - 创建时间
    - 创建用户
    - 最后修改时间
    - 最后修改用户
  - 任务配置：
    - 选股策略配置（JSON 格式）
    - 选股条件配置（价格区间、市盈率范围、市值范围等）
    - 股票池配置（全市场、自定义股票列表、行业筛选等）
    - 数据源配置（本地数据、在线数据等）
    - 输出格式配置（CSV、Excel、JSON、数据库等）
  - 任务调度配置：
    - 定时策略（Cron 表达式、固定间隔等）
    - 执行时间窗口
    - 任务优先级
    - 超时时间
    - 重试次数
    - 重试间隔
  - 任务状态：
    - 任务状态（待执行、执行中、已完成、失败、已取消）
    - 执行进度（百分比）
    - 当前执行阶段
    - 开始执行时间
    - 预计完成时间
    - 实际完成时间
  - 任务结果：
    - 选股结果数据（股票列表、筛选条件匹配度等）
    - 选股数量统计
    - 结果文件路径
    - 结果数据大小
    - 执行日志
    - 错误信息

#### 2.8.2 选股任务创建
- **功能描述**：创建新的选股任务
- **需求详情**：
  - 提供表单界面填写任务基本信息
  - 提供可视化配置选股条件
  - 提供选股策略模板选择
  - 支持导入已有任务配置
  - 支持任务配置验证
  - 支持任务配置保存为模板

#### 2.8.3 选股任务编辑
- **功能描述**：编辑已存在的选股任务
- **需求详情**：
  - 支持修改任务基本信息
  - 支持修改选股条件
  - 支持修改调度配置
  - 支持任务配置版本管理
  - 支持任务配置对比

#### 2.8.4 选股任务执行
- **功能描述**：执行选股任务
- **需求详情**：
  - 支持立即执行
  - 支持定时执行
  - 显示执行进度
  - 显示执行日志
  - 支持执行中断
  - 支持执行暂停和恢复

#### 2.8.5 选股任务列表
- **功能描述**：展示所有选股任务
- **需求详情**：
  - 以表格形式展示任务列表
  - 支持任务搜索（按名称、状态、创建时间等）
  - 支持任务筛选（按状态、创建时间范围等）
  - 支持任务排序
  - 显示任务关键信息（名称、状态、最后执行时间、下次执行时间等）
  - 支持批量操作（批量删除、批量暂停等）

#### 2.8.6 选股任务详情
- **功能描述**：展示选股任务详细信息
- **需求详情**：
  - 展示任务基本信息
  - 展示任务配置详情
  - 展示任务执行历史
  - 展示任务执行结果
  - 展示任务执行日志
  - 提供任务操作按钮（编辑、删除、立即执行、暂停、恢复等）

### 2.9 批量回测任务管理模块

#### 2.9.1 批量回测任务实体
- **功能描述**：定义批量回测任务的数据结构和属性
- **需求详情**：
  - 任务基本信息：
    - 任务 ID（唯一标识）
    - 任务名称
    - 任务描述
    - 任务类型（批量回测任务）
    - 创建时间
    - 创建用户
    - 最后修改时间
    - 最后修改用户
  - 任务配置：
    - 回测策略配置（JSON 格式）
    - 回测参数配置（买入条件、卖出条件、止损止盈等）
    - 股票池配置（全市场、自定义股票列表、行业筛选等）
    - 回测时间范围配置（开始日期、结束日期）
    - 数据源配置（本地数据、在线数据等）
    - 输出格式配置（CSV、Excel、JSON、数据库等）
    - 性能指标配置（夏普比率、最大回撤、胜率、盈亏比等）
  - 任务调度配置：
    - 定时策略（Cron 表达式、固定间隔等）
    - 执行时间窗口
    - 任务优先级
    - 超时时间
    - 重试次数
    - 重试间隔
  - 任务状态：
    - 任务状态（待执行、执行中、已完成、失败、已取消）
    - 执行进度（百分比）
    - 当前执行阶段
    - 开始执行时间
    - 预计完成时间
    - 实际完成时间
  - 任务结果：
    - 回测结果数据（每只股票的回测结果、整体统计结果等）
    - 性能指标数据（收益率、夏普比率、最大回撤、胜率、盈亏比等）
    - 交易明细数据（每笔交易的买入卖出信息）
    - 结果文件路径
    - 结果数据大小
    - 执行日志
    - 错误信息

#### 2.9.2 批量回测任务创建
- **功能描述**：创建新的批量回测任务
- **需求详情**：
  - 提供表单界面填写任务基本信息
  - 提供可视化配置回测策略
  - 提供回测策略模板选择
  - 支持参数优化配置
  - 支持导入已有任务配置
  - 支持任务配置验证
  - 支持任务配置保存为模板

#### 2.9.3 批量回测任务编辑
- **功能描述**：编辑已存在的批量回测任务
- **需求详情**：
  - 支持修改任务基本信息
  - 支持修改回测策略
  - 支持修改回测参数
  - 支持修改调度配置
  - 支持任务配置版本管理
  - 支持任务配置对比

#### 2.9.4 批量回测任务执行
- **功能描述**：执行批量回测任务
- **需求详情**：
  - 支持立即执行
  - 支持定时执行
  - 显示执行进度（总体进度、单只股票进度）
  - 显示执行日志
  - 支持执行中断
  - 支持执行暂停和恢复
  - 支持分批执行（避免一次性处理过多股票）

#### 2.9.5 批量回测任务列表
- **功能描述**：展示所有批量回测任务
- **需求详情**：
  - 以表格形式展示任务列表
  - 支持任务搜索（按名称、状态、创建时间等）
  - 支持任务筛选（按状态、创建时间范围等）
  - 支持任务排序
  - 显示任务关键信息（名称、状态、最后执行时间、下次执行时间、回测股票数量等）
  - 支持批量操作（批量删除、批量暂停等）

#### 2.9.6 批量回测任务详情
- **功能描述**：展示批量回测任务详细信息
- **需求详情**：
  - 展示任务基本信息
  - 展示任务配置详情
  - 展示任务执行历史
  - 展示任务执行结果（整体统计、单只股票详情）
  - 展示性能指标图表
  - 展示交易明细
  - 展示任务执行日志
  - 提供任务操作按钮（编辑、删除、立即执行、暂停、恢复等）

#### 2.9.7 回测结果对比
- **功能描述**：对比不同任务或不同策略的回测结果
- **需求详情**：
  - 支持选择多个任务进行对比
  - 支持选择多个策略进行对比
  - 展示关键指标对比表格
  - 展示收益率曲线对比图表
  - 支持结果数据导出

## 3. 非功能需求

### 3.1 性能需求
- 页面加载时间 < 2 秒
- API 请求响应时间 < 1 秒
- 支持并发用户数 > 100
- 定时任务调度精度 < 1 秒
- 任务执行状态实时更新延迟 < 3 秒
- 支持同时运行的任务数 > 50
- 选股任务处理 1000 只股票 < 5 分钟
- 批量回测任务处理 100 只股票 < 30 分钟
- 任务执行日志查询响应时间 < 2 秒

### 3.2 安全需求
- 使用 HTTPS 协议
- Token 有效期管理
- 敏感信息加密存储
- 防止 XSS 和 CSRF 攻击

### 3.3 兼容性需求
- 支持主流浏览器（Chrome、Firefox、Safari、Edge）
- 支持响应式布局，适配不同屏幕尺寸
- 支持移动端访问

### 3.4 可用性需求
- 界面简洁直观
- 操作流程清晰
- 提供友好的错误提示
- 支持中文界面

## 4. 技术需求

### 4.1 前端技术栈
- **框架**：React 18.3.1
- **构建工具**：Vite 5.4.8
- **UI 组件库**：Ant Design 5.21.0
- **路由管理**：React Router 6.26.0
- **HTTP 客户端**：Axios 1.7.7
- **图表库**：Recharts 2.13.3

### 4.2 后端技术栈
- **后端框架**：FastAPI
- **数据库**：MySQL 8.0+
- **ORM 框架**：SQLAlchemy 2.0+
- **任务调度**：APScheduler / Celery
- **数据验证**：Pydantic
- **异步支持**：asyncio

### 4.3 后端接口需求
- **认证接口**：POST /api/auth/login/json
  - 请求参数：username, password
  - 响应：access_token

- **定时任务接口**：
  - POST /api/tasks/create - 创建任务
  - PUT /api/tasks/{task_id} - 更新任务
  - DELETE /api/tasks/{task_id} - 删除任务
  - GET /api/tasks - 获取任务列表
  - GET /api/tasks/{task_id} - 获取任务详情
  - POST /api/tasks/{task_id}/execute - 立即执行任务
  - POST /api/tasks/{task_id}/pause - 暂停任务
  - POST /api/tasks/{task_id}/resume - 恢复任务
  - POST /api/tasks/{task_id}/cancel - 取消任务执行
  - GET /api/tasks/{task_id}/logs - 获取任务执行日志
  - GET /api/tasks/{task_id}/results - 获取任务执行结果

- **选股任务接口**：
  - POST /api/stock-selection/tasks/create - 创建选股任务
  - PUT /api/stock-selection/tasks/{task_id} - 更新选股任务
  - DELETE /api/stock-selection/tasks/{task_id} - 删除选股任务
  - GET /api/stock-selection/tasks - 获取选股任务列表
  - GET /api/stock-selection/tasks/{task_id} - 获取选股任务详情
  - POST /api/stock-selection/tasks/{task_id}/execute - 立即执行选股任务
  - GET /api/stock-selection/tasks/{task_id}/results - 获取选股任务结果

- **批量回测任务接口**：
  - POST /api/backtest/tasks/create - 创建批量回测任务
  - PUT /api/backtest/tasks/{task_id} - 更新批量回测任务
  - DELETE /api/backtest/tasks/{task_id} - 删除批量回测任务
  - GET /api/backtest/tasks - 获取批量回测任务列表
  - GET /api/backtest/tasks/{task_id} - 获取批量回测任务详情
  - POST /api/backtest/tasks/{task_id}/execute - 立即执行批量回测任务
  - GET /api/backtest/tasks/{task_id}/results - 获取批量回测任务结果
  - POST /api/backtest/compare - 对比多个回测任务结果

- **其他业务接口**：待定义

### 4.4 数据库设计

#### 4.4.1 数据库选型
- **数据库类型**：MySQL 8.0+
- **字符集**：utf8mb4
- **排序规则**：utf8mb4_unicode_ci
- **存储引擎**：InnoDB
- **时区设置**：Asia/Shanghai
- **连接池配置**：
  - 最小连接数：5
  - 最大连接数：50
  - 连接超时：30 秒
  - 空闲连接超时：300 秒

#### 4.4.2 数据库表设计
- 详细的数据库表设计请参考 [实体设计.md](file:///Users/noctis/Documents/code/stock/StockTradebyZ/实体设计.md)
- 包含 9 张核心表的完整 DDL 语句
- 包含表关系图（ER图）
- 包含索引设计和外键约束
- 包含分区策略配置

#### 4.4.3 数据库初始化脚本
- 提供完整的数据库初始化 SQL 脚本
- 包含所有表的创建语句
- 包含索引创建语句
- 包含外键约束
- 包含分区策略配置
- 包含初始数据（如系统配置、默认模板等）

#### 4.4.4 数据库备份策略
- 全量备份：每天凌晨 2 点执行
- 增量备份：每小时执行
- 备份保留：全量备份保留 30 天，增量备份保留 7 天
- 备份存储：本地存储 + 云存储（可选）

### 4.5 数据存储
- Token 存储在 localStorage
- 用户会话管理
- 任务数据存储：
  - 任务基本信息存储在数据库
  - 任务配置存储为 JSON 格式
  - 任务执行日志存储在数据库或文件系统
  - 任务执行结果存储在数据库或文件系统
  - 历史任务数据支持归档和清理
- 选股结果数据存储：
  - 支持存储为 CSV、Excel、JSON 文件
  - 支持存储到数据库
  - 支持结果数据缓存
- 回测结果数据存储：
  - 支持存储为 CSV、Excel、JSON 文件
  - 支持存储到数据库
  - 支持结果数据缓存
  - 支持交易明细数据存储

## 5. 界面需求

### 5.1 设计风格
- 简洁现代的设计风格
- 使用 Ant Design 设计规范
- 渐变色背景（登录页）
- 卡片式布局（工具箱）

### 5.2 色彩方案
- 主色调：蓝色系（#1890ff）
- 成功色：绿色（#52c41a）
- 危险色：红色
- 背景色：浅灰色（#f0f2f5）

### 5.3 交互设计
- 按钮悬停效果
- 卡片悬停效果
- 加载状态提示
- 错误提示消息

## 6. 开发计划

### 6.1 已完成功能
- ✅ 用户登录功能
- ✅ 用户登出功能
- ✅ 路由守卫
- ✅ 工具箱首页
- ✅ 基础页面框架

### 6.2 待开发功能
- ⏳ 选股工具完整功能
- ⏳ 批量回测工具完整功能
- ⏳ 个股回测工具完整功能
- ⏳ 定时任务工作流系统
- ⏳ 选股任务管理模块
- ⏳ 批量回测任务管理模块
- ⏳ 数据可视化图表
- ⏳ 用户设置功能
- ⏳ 数据导出功能

## 7. 验收标准

### 7.1 功能验收
- 所有功能模块正常运行
- 用户认证流程完整
- 路由跳转正确
- API 请求正常

### 7.2 性能验收
- 页面加载速度达标
- API 响应时间达标
- 无明显卡顿

### 7.3 兼容性验收
- 主流浏览器测试通过
- 响应式布局正常
- 移动端适配正常

## 8. 风险与限制

### 8.1 技术风险
- 第三方库版本兼容性
- 浏览器兼容性问题
- 性能优化挑战

### 8.2 业务风险
- 数据准确性
- 实时数据更新
- 用户隐私保护

### 8.3 限制条件
- 依赖后端 API 接口
- 需要稳定的网络连接
- 浏览器需要支持 ES6+

## 9. 未来规划

### 9.1 短期规划
- 完成选股工具核心功能
- 完成批量回测工具核心功能
- 完成个股回测工具核心功能
- 完成定时任务工作流系统
- 完成选股任务管理模块
- 完成批量回测任务管理模块
- 优化用户体验

### 9.2 长期规划
- 添加更多技术指标
- 支持自定义策略
- 添加实时行情功能
- 添加社区交流功能
- 移动端 App 开发